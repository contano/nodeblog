<!DOCTYPE html><html lang="pl"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Obróbka zdjęć z perspektywy filozoficznej ;) - nodeblog</title><meta name="description" content="Obróbka zdjęć - postprodukcja w fotografii cyfrowej i analogowej"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://nodeblog.contano.xyz/obrobka-zdjec-z-perspektywy-filozoficznej.html"><meta property="og:title" content="Obróbka zdjęć z perspektywy filozoficznej ;)"><meta property="og:image" content="https://nodeblog.contano.xyz/media/posts/4/postprodukcja-w-fotografii.jpg"><meta property="og:image:width" content="750"><meta property="og:image:height" content="500"><meta property="og:site_name" content="nodeblog"><meta property="og:description" content="Obróbka zdjęć - postprodukcja w fotografii cyfrowej i analogowej"><meta property="og:url" content="https://nodeblog.contano.xyz/obrobka-zdjec-z-perspektywy-filozoficznej.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@node_contano"><meta name="twitter:title" content="Obróbka zdjęć z perspektywy filozoficznej ;)"><meta name="twitter:description" content="Obróbka zdjęć - postprodukcja w fotografii cyfrowej i analogowej"><meta name="twitter:image" content="https://nodeblog.contano.xyz/media/posts/4/postprodukcja-w-fotografii.jpg"><link rel="alternate" type="application/atom+xml" href="https://nodeblog.contano.xyz/feed.xml"><link rel="alternate" type="application/json" href="https://nodeblog.contano.xyz/feed.json"><link rel="stylesheet" href="https://nodeblog.contano.xyz/assets/css/style.css?v=8b156f4c2295bf3d8dd00cc5c2a4561a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://nodeblog.contano.xyz/obrobka-zdjec-z-perspektywy-filozoficznej.html"},"headline":"Obróbka zdjęć z perspektywy filozoficznej ;)","datePublished":"2023-01-11T20:40","dateModified":"2023-01-12T10:02","image":{"@type":"ImageObject","url":"https://nodeblog.contano.xyz/media/posts/4/postprodukcja-w-fotografii.jpg","height":500,"width":750},"description":"Obróbka zdjęć - postprodukcja w fotografii cyfrowej i analogowej","author":{"@type":"Person","name":"Jacek","url":"https://nodeblog.contano.xyz/authors/jacek/"},"publisher":{"@type":"Organization","name":"Jacek"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script>(function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
    .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
    n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
    (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
    ml('account', '288486');</script><meta name="google-site-verification" content="4mJQfUbYSrgL5LLFl-0oRLjF-36eci2mErv6b0Hs9hM"></head><body><header class="header" id="js-header"><div class="wrapper"><a class="logo" href="https://nodeblog.contano.xyz/">nodeblog</a></div></header><main class="main"><div class="wrapper"><div class="post"><article><header class="post__header post__header--partial"><div class="post__header--partial__left"><div><time datetime="2023-01-11T20:40" class="post__meta-date">11 sty 2023</time><h1 class="post__title">Obróbka zdjęć z perspektywy filozoficznej ;)</h1><div class="author post__meta-author--partial"><img src="https://nodeblog.contano.xyz/media/website/logo-contano.png" loading="eager" height="1024" width="1024" class="author__avatar" alt="Jacek"><div class="author__info"><a href="https://nodeblog.contano.xyz/authors/jacek/" class="invert author__name" rel="author">Jacek </a>Jacek Cholewa - autor nodeblog</div></div></div></div><figure class="post__hero-image post__hero-image--partial"><img src="https://nodeblog.contano.xyz/media/posts/4/postprodukcja-w-fotografii.jpg" srcset="https://nodeblog.contano.xyz/media/posts/4/responsive/postprodukcja-w-fotografii-xs.jpg 300w, https://nodeblog.contano.xyz/media/posts/4/responsive/postprodukcja-w-fotografii-sm.jpg 480w, https://nodeblog.contano.xyz/media/posts/4/responsive/postprodukcja-w-fotografii-md.jpg 768w, https://nodeblog.contano.xyz/media/posts/4/responsive/postprodukcja-w-fotografii-xl.jpg 1200w, https://nodeblog.contano.xyz/media/posts/4/responsive/postprodukcja-w-fotografii-xxl.jpg 1600w, https://nodeblog.contano.xyz/media/posts/4/responsive/postprodukcja-w-fotografii-xxxl.jpg 2560w" sizes="(max-width: 2560px) 100vw, 2560px" loading="eager" height="500" width="750" alt="postprodukcja w fotografii"></figure></header><div class="post__inner post__entry"><p>Jakoś tak mnie naszło, żeby podjąć temat postprodukcji w fotografii z filozoficznego punktu widzenia ;) Wzięło się to stąd, że zdarza mi się obserwować spór pomiędzy miłośnikami Photoshopa i tymi, którzy uważają, że obróbka zdjęć odbiera im ich prawdziwość. Zwolennicy fotografowania "na gotowo" często przywołują argument, że epoka cyfry zniszczyła prawdziwego ducha fotografii. Odwołują się także do technik analogowych, wskazując, że w epoce błon światłoczułych fotografia była czysta i prawdziwa, a obecnie jest straszliwym wytworem programów komputerowych ;) Osobiście fotografuję zarówno cyfrą jak i analogiem. Zdecydowanie więcej zdjęć robię jednak na filmach, które sam wywołuję, powiększam tradycyjnie w ciemni, a także digitalizuję. Przedstawię więc tutaj mój osobisty punk widzenia na kwestię postprodukcji i tak zwanej "prawdziwej, czystej fotografii na gotowo".</p><h2 id="czy-fotografia-cyfrowa-bez-postprodukcji-w-ogle-istnieje">Czy fotografia cyfrowa bez postprodukcji w ogóle istnieje?</h2><p>Na początku tych rozważań odpowiem krótko. Moim zdaniem nie ma czegoś takiego jak czysta fotografia bez obróbki. Postprodukcja jest immanentną składowa procesu fotograficznego. Dlaczego? Gdy robisz zdjęcia smartfonem, albo aparatem cyfrowym i używasz formatu JPG, zlecasz procesorowi obrazu w tych urządzeniach przeprowadzenie obróbki zgodnie z wybranym schematem tematycznym, zadanym mu z poziomu ustawień aparatu. No dobrze, ale przecież mogę fotografować używając formatu RAW, a następnie wywołać RAW-y przy pomocy dedykowanego oprogramowania, takiego jak np. Adobe Camera RAW. Określenie surowy plik RAW jest moim zdaniem nieco mylące, podobnie jak sformułowanie "wywoływanie RAW-ów". Plik RAW różni się od pliku JPG tak naprawdę tym, że format RAW pozwala zapisać więcej danych o konfiguracji warunków, w których zdjęcie zostało zrobione. Większa ilość informacji skutkuje tym, że w procesie postprodukcji masz szersze możliwości manipulowania danymi opisującymi zapisany obraz, niż w przypadku formatów o stratnej konwersji, takich jak JPG, które z kolei zajmują mniej miejsca na karcie pamięci twojego urządzenia. Procesor aparatu cyfrowego tworząc plik RAW dokonuje obróbki obrazu podobnie jak czyni to z plikami JPG z tą różnicą, że zapisuje więcej szczegółowych informacji. Reasumując, zawsze mamy do czynienia z jakąś formą obróbki dokonywaną przez procesor obrazu. Sama matryca aparatu cyfrowego także dokonuje interpretacji danych, które płyną z diod światłoczułych, np. w oparciu o filtr Bayera w układach CMOS. I gdzie tutaj jest "czysta fotografia"? "Na gotowo" oznacza tylko i wyłącznie to, że zamiast samemu dokonać postprodukcji po zgraniu zdjęć, poprzestajesz na obróbce, której dokonał procesor obrazu aparatu cyfrowego w oparciu o zaprogramowane algorytmy.</p><h2 id="co-z-fotografi-analogow-czy-moe-by-wykonana-na-gotowo">Co z fotografią analogową? Czy może być wykonana "na gotowo"?</h2><p>Znowu odpowiem krótko. Nie może. O sposobie interpretacji fotografowanej sceny decydujesz już w momencie zakupu kliszy, lub błony światłoczułej. Każdy negatyw i slajd ma nieco inną charakterystykę tonalną i ziarnistość. Kolejne ingerencje mają miejsce na etapie wywoływania filmu. W fotografii czarno-białej możesz użyć różnych kombinacji film - wywoływacz i dadzą one różne efekty finalne. Wywołując negatyw kolorowy w procesie C-41 a slajd w procesie E-6 jesteś zdany na nieco większą standaryzację. Możliwe jest jednak krosowanie, czyli wołanie negatywów kolorowych w chemii E-6 i slajdów w procesie C-41. W efekcie otrzymasz przekłamane kolory względem obserwowanych gołym okiem. Bardziej intensywne mieszanie podczas wołania filmów zarówno kolorowych jak i czarno-białych zwiększa ich ziarnistość. Forsowanie filmów podbija kontrast i nasycenie kolorów. Pracując z tradycyjną odbitką pod powiększalnikiem możesz ja wykadrować, możesz prostować perspektywę, regulować światła i cienie a przy fotografii czarno-białej zmieniać kontrast poprzez użycie filtracji. Wybór określonego papieru do wykonania powiększeń także wpływa na finalny wygląd fotografii. A co z retuszem, czy da się go przeprowadzić korzystając z technik analogowych? Oczywiście, że tak, korekt retuszerskich można dokonać zarówno na powierzchni wywołanego filmu jak i na gotowej już, wysuszonej odbitce. Jak widzisz, w procesach analogowych obróbka także jest obecna praktycznie na każdym etapie tworzenia zdjęcia. Digitalizując negatyw, czy slajd również dokonujesz interpretacji parametrów takich jak kontrast, czy nasycenie barw. Ratunkiem dla istnienia "czystej fotografii" zdają się być wyłącznie techniki szlachetne, takie jak mokry kolodion ;) Gdy przyjrzysz się im z uwagą, dostrzeżesz, że i one poprzez użycie określonych chemikaliów determinują finalny wynik, który wcale nie będzie oddawał tego, co widzą twoje oczy, gdy obserwujesz scenę, którą zamierzasz sfotografować.<br></p><h2 id="w-fotografii-kluczowa-jest-wiadomo-sceny">W fotografii kluczowa jest świadomość sceny</h2><p>No cóż, niewątpliwie jest prawdą, że fotografia analogowa zmusza do bardziej przemyślanej pracy z planem zdjęciowym. Nie widzisz efektu po zrobieniu zdjęcia, więc musisz go sobie wyobrazić. Moim zdaniem w praktyce sprawia to, że fotografując analogiem z reguły jesteśmy bardziej uważni. Powstaje finalnie mniej zdjęć, ale bardziej przemyślanych. Wiedza o filmach, wywoływaczach, filtrach na obiektywie, kręceniu koreksem, manualnych parametrach ekspozycji sprawia, że oczami wyobraźni możesz dostrzec efekt, który chciałbyś uzyskać, zanim on się fizycznie pojawi. Fotografując cyfrą wielu ludzi po prostu pstryka a potem z tysięcy zdjęć zrobionych na jednaj sesji coś wybiera i wyciąga co się da w programach do obróbki graficznej. Istota sprawy nie tkwi moim zdaniem w odrzucaniu postprodukcji, bo to jest po prostu technicznie nierealne. Chodzi raczej o bardziej lub mniej świadome, przemyślane złożenie się do strzału ;) Technologia cyfrowa pozwala strzelać na oślep, bardziej wybacza błędy w celowaniu i sprawia, że prawie zawsze coś wyjdzie dobrze. W analogu moment celowania, przymierzenia się do oddania strzału wymaga więcej precyzji. Będziemy więc siłą rzeczy zwracać baczniej uwagę na kadr, światło, temat posługując się aparatem analogowym. Fotografując cyfrą także możemy to zrobić. Trzeba jednak pamiętać, że wygoda rozleniwia a lenistwo nie sprzyja ani dbałości o detale, ani twórczej kreatywności ;) Jednemu i drugiemu sprzyja natomiast wiedza, uważna obserwacja i wyobraźnia, która jest na tyle wytrenowana, że potrafi wzbudzić świadomość pożądanego efektu finalnego, który chcemy uzyskać w postaci gotowej do obejrzenia fotografii. Robiąc zdjęcia na filmach mamy jeszcze jeden element, którego nie daje nam technologia cyfrowa. Jest nim niewiadoma, która zostaje odkryta dopiero, gdy z chemicznych roztworów wyłoni się wywołamy materiał ;) Niespodzianka, która zawsze do pewnego stopnia towarzyszy fotografowaniu analogiem, wzmacnia moim zdaniem świadomość sceny, gdy składamy się do strzału ;)</p></div><footer class="post__footer"><div class="post__inner post__footer-inner"><div class="post__updated">Zaktualizowano: <time datetime="2023-01-12T10:02">12 sty 2023</time></div><div class="post__actions is-tag"><ul class="post__tag"><li><a href="https://nodeblog.contano.xyz/tags/fotografia-analogowa/" title="fotografia analogowa">fotografia analogowa</a></li><li><a href="https://nodeblog.contano.xyz/tags/fotografia-cyfrowa/" title="fotografia cyfrowa">fotografia cyfrowa</a></li><li><a href="https://nodeblog.contano.xyz/tags/postprodukcja-w-fotografii/" title="postprodukcja">postprodukcja</a></li><li><a href="https://nodeblog.contano.xyz/tags/przemyslenia/" title="przemyślenia">przemyślenia</a></li></ul><div class="post__share"><button class="post__share-button js-post__share-button" aria-label="Udostępnij"><svg width="32" height="32"><use xlink:href="https://nodeblog.contano.xyz/assets/svg/svg-map.svg#share"></use></svg></button><div class="post__share-popup js-post__share-popup"><a href="https://twitter.com/share?url=https%3A%2F%2Fnodeblog.contano.xyz%2Fobrobka-zdjec-z-perspektywy-filozoficznej.html&amp;via=%40contano_nft&amp;text=Obr%C3%B3bka%20zdj%C4%99%C4%87%20z%20perspektywy%20filozoficznej%20%3B)" class="js-share twitter" aria-label="Udostępnij z... Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://nodeblog.contano.xyz/assets/svg/svg-map.svg#twitter"/></svg> Twitter </a><a href="https://api.whatsapp.com/send?text=Obr%C3%B3bka%20zdj%C4%99%C4%87%20z%20perspektywy%20filozoficznej%20%3B) https%3A%2F%2Fnodeblog.contano.xyz%2Fobrobka-zdjec-z-perspektywy-filozoficznej.html" class="js-share whatsapp" aria-label="Udostępnij z... WhatsApp" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://nodeblog.contano.xyz/assets/svg/svg-map.svg#whatsapp"/></svg> WhatsApp</a></div></div></div></div><div class="post__inner author post__author"><img src="https://nodeblog.contano.xyz/media/website/logo-contano.png" loading="lazy" height="1024" width="1024" class="author__avatar" alt="Jacek"><div class="author__info"><a href="https://nodeblog.contano.xyz/authors/jacek/" class="invert author__name" rel="author">Jacek </a>Jacek Cholewa - autor nodeblog</div></div></footer></article></div></div><nav class="post__nav"><div class="wrapper"><div class="post__nav-inner"><div class="post__nav-prev"><a href="https://nodeblog.contano.xyz/digitalizacja-filmow-przewodnik.html" rel="prev" class="post__nav-link"><span>Poprzedni</span><h5 class="invert">Digitalizacja filmów - przewodnik</h5></a></div><div class="post__nav-next"><a href="https://nodeblog.contano.xyz/lustrzanka-czy-bezlusterkowiec-oto-jest-pytanie.html" rel="next" class="post__nav-link"><span>Następny</span><h5 class="invert">Lustrzanka czy bezlusterkowiec? Oto jest pytanie.</h5></a></div></div></div></nav><div class="section section--light s-t-2 s-b-2 post__comments"><div class="wrapper"><div class="post__comments-inner"><div class="comments"><div class="comments-wrapper"><h4>Komentarze</h4><div id="cusdis_thread" data-host="https://cusdis.com" data-app-id="78463a9e-dd9f-428d-a4e4-e0d7921c04c0" data-page-id="4" data-page-url="https://nodeblog.contano.xyz/obrobka-zdjec-z-perspektywy-filozoficznej.html" data-page-title="Obróbka zdjęć z perspektywy filozoficznej ;)" data-theme="auto"></div><noscript>Zezwól Java Script w swojej przeglądarce internetowej na korzystanie z formularza komentarzy.</noscript><script type="text/javascript">var cusdis_element_to_check = document.getElementById('cusdis_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.defer = true;
										s.src = 'https://cusdis.com/js/cusdis.es.js';									
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(cusdis_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.defer = true;
						s.src = 'https://cusdis.com/js/cusdis.es.js';
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div></div></div></div></main><footer class="footer s-t-2 s-b-2"><div class="wrapper footer__inner"><a class="footer__logo" href="https://nodeblog.contano.xyz/">nodeblog</a><div class="footer__social"><a href="https://twitter.com/node_contano" aria-label="Twitter" target="_blank"><svg><use xlink:href="https://nodeblog.contano.xyz/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/contano.nft" aria-label="Instagram" target="_blank"><svg><use xlink:href="https://nodeblog.contano.xyz/assets/svg/svg-map.svg#instagram"/></svg></a></div><div class="footer__copy">nodeblog © all rights reserved | email: <b>syrgiusz@gmail.com</b></div></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Wróć do początku" title="Wróć do początku"><svg><use xlink:href="https://nodeblog.contano.xyz/assets/svg/svg-map.svg#toparrow"/></svg></button></footer><script defer="defer" src="https://nodeblog.contano.xyz/assets/js/scripts.min.js?v=52e8633fef550fd24604b45454cd7610"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">Ta strona korzysta z plików cookie</div><div id="pcb-txt" class="pcb__txt">Ta witryna wykorzystuje pliki cookie do badania ruchu na stronie i aktywności użytkowników w celach marketingowych oraz w celu zapewnienia funkcjonalności mediów społecznościowych. Możesz określić warunki przechowywania lub dostępu do plików cookie w Twojej przeglądarce. <a href="https://nodeblog.contano.xyz/polityka-prywatnosci-oraz-cookies-nodeblog.html">Zobacz szczegóły</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Rozumiem</button></div></div></div><button class="pcb__badge" aria-label="Polityka prywatności" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>